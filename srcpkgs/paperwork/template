# Template file for 'paperwork'
pkgname=paperwork
version=2.2.2
revision=1
short_desc="Personal document manager for scanned documents (and PDFs)"
maintainer="idealist1508 <id1508-github@yahoo.com>"
license="GPL-3.0-or-later"
homepage="https://www.openpaper.work/"
distfiles="https://gitlab.gnome.org/World/OpenPaperwork/paperwork/-/archive/${version}/paperwork-${version}.tar.bz2"
checksum=006b4f95d9c5665dbcd0cdbd851f7164f0abc5fbf91138157f3768d9cae3ff51

python_version=3
hostmakedepends="gettext which python3-pillowfight python3-build python3-installer python3-setuptools_scm python3-wheel python3-distro python3-psutil python3-numpy python3-scipy python3-scikit-learn python3-pycountry python3-Whoosh python3-xdg python3-pyocr"
depends="libhandy1 poppler-glib python3-distro python3-rich python3-psutil python3-pillowfight python3-gobject python3-numpy python3-scipy python3-scikit-learn python3-distutils-extra python3-pycountry python3-Whoosh python3-xdg python3-fabulous python3-pyocr"

case $XBPS_TARGET_MACHINE in
	x86_64*) depends+=" python3-pillow-simd" ;;
	*) depends+=" python3-Pillow" ;;
esac

export SETUPTOOLS_SCM_PRETEND_VERSION=${version}

do_build() {
	make l10n_compile

	for dir in openpaperwork-{core,gtk} paperwork-{backend,shell,gtk}; do
		pushd $dir
		python -m build --wheel --no-isolation
		popd
	done
}

do_install() {
	for dir in openpaperwork-{core,gtk} paperwork-{backend,shell,gtk}; do
		pushd $dir
		python -m installer --destdir="$DESTDIR" dist/*.whl
		popd
	done

 PYTHONPATH="$DESTDIR"$(python -c 'import site; print(site.getsitepackages()[0])') \
	"$DESTDIR"/usr/bin/paperwork-gtk install \
	--icon_base_dir="$DESTDIR/usr/share/icons" \
	--data_base_dir="$DESTDIR/usr/share"
}
